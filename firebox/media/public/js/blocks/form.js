var FireBox_Form=function(){function e(e){this.form=e,this.submitButtonClass=".firebox-block-button-element",this.formControlGroupClass=".fb-form-control-group",this.formInputClass=".fb-form-input",this.formMessageClass=".fb-form-response",this.requiredFieldMessage=this.form.querySelector(".fb_form_required_field_message").value,this.invalidEmailMessage=this.form.querySelector(".fb_form_invalid_email_message").value,this.honeypotFieldTriggered=this.form.querySelector(".fb_form_honeypot_field_triggered")?this.form.querySelector(".fb_form_honeypot_field_triggered").value:"",this.initEvents()}var t=e.prototype;return t.initEvents=function(){var t=this;this.prepareFormButtons(),this.form.querySelector(this.submitButtonClass)&&this.form.querySelector(this.submitButtonClass).addEventListener("click",this.submitForm.bind(this)),this.form.addEventListener("keyup",function(e){t.onFormEnterSubmit(e)}),this.form.addEventListener("focusout",function(e){t.updateFieldStateWhileTyping(e)})},t.prepareFormButtons=function(){this.form.querySelectorAll(".firebox-block-button-element").forEach(function(e){e.setAttribute("tabindex",0)})},t.updateFieldStateWhileTyping=function(e){var t,r=e.target.closest(this.formInputClass);r&&((t=this.validateField(r)).error?this.setFieldHasError(r,t.error):this.setFieldHasNoError(r))},t.onFormEnterSubmit=function(e){e.preventDefault(),13!==e.keyCode||this.isTextareaField(e.target)||this.submitForm(e)},t.isTextareaField=function(e){return e.closest("textarea.fb-form-input")},t.submitForm=function(s){var o=this;s.preventDefault();var n=this.getFields();if(n){var a=!0,l={form_id:this.form.querySelector('input[name="fb_form[form_id]"]').value,fields:{}},m=null;if(Object.keys(n).forEach(function(e){var t=n[e];"fb_form[hnpt]"===t.name&&""!==t.value&&(a=!1,o.showFormMessage(o.honeypotFieldTriggered,!0));var r=o.validateField(t);if(r.error)return a=!1,o.setFieldHasError(t.element,r.error),void(m||(m=!0,t.element.focus()));o.setFieldHasNoError(t.element);var i=(i=e.replace("fb_form[","")).replace("]","");l.fields[i]=r}),a){this.setLoading(!0);var f=this,e=this.emitEvent("beforeSubmit");if(e.defaultPrevented)return e.detail.hasOwnProperty("error")&&this.showFormMessage(e.detail.error,!0),void f.setLoading(!1);var t=this.form.closest(".fb-inst")?this.form.closest(".fb-inst").dataset.id:null,r=!!this.form.closest(".fb-inst")&&parseInt(this.form.closest(".fb-inst").firebox.box_log_id),i=new FormData;i.append("nonce",fbox_js_object.nonce),i.append("action","fb_form_submit"),i.append("form_data",JSON.stringify(l)),i.append("box_log_id",r),i.append("box_id",t),fetch(fbox_js_object.ajax_url,{method:"post",body:i}).then(function(e){return e.json()}).then(function(e){var i,t;e.validation&&e.validation.length?(i=!1,e.validation.forEach(function(e){var t="fb_form["+e.name+"]";"radio"===e.type&&(t+="[]");var r=f.form.querySelector(f.formInputClass+'[name="'+t+'"]');i=!0,f.setFieldHasError(r,e.validation_message)}),i&&f.showFormMessage(e.message,!0),f.emitEvent("validation_error",{response:e})):e.error?(f.showFormMessage(e.message,e.error),f.emitEvent("error",{response:e})):("message"===e.action?f.showFormMessage(e.message,e.error):(t=f.emitEvent("beforeRedirectUser",{url:e.redirectURL}),window.location.href=t.detail.url),e.resetForm&&f.resetForm(n),e.hideForm&&f.form.classList.add("fb-hide-form"),f.form.closest(".fb-inst")&&f.form.closest(".fb-inst").classList.add("fb-form-success"),f.emitEvent("success",{response:e,submitButton:s.srcElement}));var r=f.getFormMessage();r&&!f.isInViewport(r)&&r.scrollIntoView(),e.hideForm||f.setLoading(!1)})}}},t.isInViewport=function(e){var t=e.getBoundingClientRect();return 0<=t.top&&0<=t.left&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},t.emitEvent=function(e,t,r){var i;if(e)return(t=t||{}).instance=this,(r=r||!0)&&(i="FireBoxForm"+this.capitalize(e),this.dispatchEvent(i,document,t)),this.dispatchEvent(e,this.form,t)},t.capitalize=function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},t.dispatchEvent=function(e,t,r){var i=new CustomEvent(e,{detail:r,cancelable:!0});return t.dispatchEvent(i),i},t.resetForm=function(t){Object.keys(t).forEach(function(e){t[e].element.value="","radio"===t[e].type&&(t[e].element.checked=!1)})},t.setLoading=function(e){void 0===e&&(e=!0);var t=this.form.querySelector(this.submitButtonClass);t&&(e?(t.dataset.initialLabel||t.setAttribute("data-initial-label",t.innerHTML),t.classList.add("is-working"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="10" r="40" stroke-dasharray="164.93361431346415 56.97787143782138"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg>'):(t.innerHTML=t.dataset.initialLabel,t.classList.remove("is-working")))},t.showFormMessage=function(e,t){void 0===t&&(t=!1);var r=this.getFormMessage();r||(this.form.appendChild(this.getFormMessageTemplate()),r=this.getFormMessage()),r.classList.add("fb-msg-is-visible"),r.innerHTML=e,t?r.classList.add("is-error"):r.classList.remove("is-error")},t.getFormMessage=function(){return this.form.querySelector(this.formMessageClass)},t.getFormMessageTemplate=function(){var e=document.createElement("div");return e.className=this.formMessageClass.substring(1),e},t.hideFormMessage=function(){var e=this.getFormMessage();e&&(e.classList.remove("fb-msg-is-visible","is-error"),e.innerHTML="")},t.setFieldHasError=function(e,t){var r,i;!e||(r=e.closest(this.formControlGroupClass))&&(r.classList.contains("has-errors")?r.querySelector(".fb-form-field-error").innerHTML=t:(r.classList.add("has-errors"),(i=this.getErrorMessageTemplate()).innerHTML=t,r.appendChild(i)))},t.getErrorMessageTemplate=function(){var e=document.createElement("div");return e.className="fb-form-field-error",e},t.setFieldHasNoError=function(e){var t=e.closest(this.formControlGroupClass);t&&t.classList.contains("has-errors")&&(t.classList.remove("has-errors"),t.querySelector(".fb-form-field-error").remove())},t.validateField=function(e){var t=e.name,r=e.type,i=e.value;if((e.required||!1)&&"hidden"!==r){var s=!1;if("checkbox"===r&&i instanceof Array?0===i.length&&(s=!0):""===i.trim()&&(s=!0),s)return{error:this.requiredFieldMessage}}if("email"===r&&!this.validateEmail(i))return{error:this.invalidEmailMessage};var o=e instanceof HTMLElement?e:e.element,n=null;return o.closest(".fb-form-control-group")&&(n=o.closest(".fb-form-control-group").dataset.fieldId),{name:t,type:r,value:i,id:n}},t.getFields=function(){var f=this,c=[];return this.form.querySelectorAll(this.formInputClass).forEach(function(e){var t=e.name.replace("[]","");if(!c[t]){var r="input",i=e.name,s=e.type,o=e.value;switch(s){case"select-one":r="select";break;case"textarea":r=s}var n,a,l=f.form.querySelector(r+'.fb-form-input[name="'+i+'"]');"radio"==s?(o="",(n=f.form.querySelector(r+'.fb-form-input[name="'+i+'"]:checked'))&&(o=(l=n)?l.value:"")):"checkbox"===s&&(o="",(a=f.form.querySelectorAll(r+'.fb-form-input[name="'+i+'"]:checked')).length&&(o=[],a.forEach(function(e){o.push(e.value)})));var m={name:i,type:s,value:o,required:e.required,element:l};c[t]=m}}),c},t.validateEmail=function(e){return String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},e}();document.addEventListener("DOMContentLoaded",function(e){document.querySelectorAll("form.wp-block-firebox-form").forEach(function(e){new FireBox_Form(e)})});

